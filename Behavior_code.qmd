---
title: "Owrasse_Underwater_Behavior"
format: pdf
editor: visual
---

# Quick Intro

This quarto document contains the code used to visualize data from UW_Nest_Behavioral_Cleaned. The goals of this project is to understand what factors influence the mating decisions that female Ocellated wrasse make. What makes *Symphodus ocellatus* (the ocellated wrasse) interesting is their 3 different male reproductive tactics. Additionally, there are large amounts of mate choice copying from the females, so much so that a male is up significantly more likely to spawn with a female if she observes another female with him ([Alonzo 2008](https://www.sciencedirect.com/science/article/pii/S0003347208000225)).

The data used was collected live underwater by SCUBA divers in Corsica, Fr, in a 10 minute period.

# Tidy Code

First run our library list (Install first if you don't have these packages).

```{r}
#Install and library important packages
#install.packages('ggplot2')
#install.packages('RColorBrewer')
#install.packages('here')
#install.packages('tidyverse')
#install.packages('readxl')
#install.packages('brms')
library(tidyverse)
library(here)
library(ggplot2)
library(readxl)
library(dplyr)
library(brms)
library(RColorBrewer)
library(tibble)
```

Importing the data sheet

```{r}
behavior_sheet <- read_excel("UW_Nest_Behavioral_Sheets_Cleaned.xlsx")
head(behavior_sheet)
```

Separating the date column and placing it near the original Date column for filtering ease later on.

```{r}
behavior_sheet_date <- as.Date(behavior_sheet$Date)
behavior_sheet$Date <- behavior_sheet_date
behavior_sheet_sep <- behavior_sheet %>%
  mutate(Year = year(Date)) %>%
  mutate(Month = month(Date)) %>%
  mutate(Day = day(Date)) %>%
  relocate(Year, .after = Date) %>%
  relocate(Month, .after = Year) %>%
  relocate(Day, .after = Month)
head(behavior_sheet_sep)
```

## Year totals

For ease of comparison between years and months, this code will add up the total number of nests for each year.

```{r}
#Fix SAT submission to NM from chr to num
sat_sub <- as.numeric(behavior_sheet_sep$`SAT submission to NM`)
behavior_sheet_sep$`SAT submission to NM` <- sat_sub

yearly_totals <- behavior_sheet_sep |>
  group_by(Year) |>
  summarise(
    # count the number of nests in each year
    total_nests = n(),
    # take the avg of the "Average SNK" column for each year and make new column
    avg_SNKR = mean(`Average SNK`, na.rm = TRUE),
          # include only numeric columns
    across(where(is.numeric) &
             # exclude Month, Day, and Average SNKR column
             !c(Month, Day, `Average SNK`), 
           # add up remaining totals per year for each column
           ~ sum(.x, na.rm = TRUE)))

yearly_totals

#Turn the year variable into a character for ease of comparison later on
year_date <- as.character(yearly_totals$Year) #Creates a vector with years as chr
yearly_totals$Year_axis <- year_date #creates a new variable for ease of graphing later on

head(yearly_totals) #Double Check
```

### Exploratory graphs looking between the years

#### Average sneakers between years

```{r}
avg_snk_years <- yearly_totals |>
  ggplot(aes(x = Year_axis, y = avg_SNKR, fill = Year_axis)) + #gives ggplot the dimensions
  geom_bar(stat = 'identity') + 
  labs(x = 'Year', 
       y = 'Average number of Sneakers',
       title = "Number of Sneakers Between the Years",
       fill = 'Year
       ') + #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars
avg_snk_years
```

#### Average Nesting Male Time in/near nest between years

```{r}
NM_in_near <- yearly_totals |>
  group_by(Year_axis) |> #Focusing on per year
  summarise(
    #Get the total amount of time that the NM was recorded
    total_time = round(sum(`# NM in` + `# NM near` + `# NM far`), digits = 4),
    #Get the percent of time the NM was in his nest.
    NM_in = round((`# NM in`/total_time)*100, digits = 4),
    #Get the percent of time the NM was near his nest.
    NM_near = round((`# NM near`/total_time)*100, digits = 4),
    #Get the percent of time the NM was far from his nest
    NM_far = round((`# NM far`/total_time)*100, digits = 4))

NM_in_near.long <- NM_in_near %>% 
  pivot_longer(cols = -c(Year_axis, total_time), #Take all tibble coloumns except Years and total time
               names_to = "distance", # Put the percent coloumns into their own
               values_to = "perc_time") #Put previous' columns into a new one


NM_in_near.long %>%
  ggplot(aes(Year_axis, perc_time, fill = distance)) +
  geom_col() +
    labs(x = 'Year', 
       y = 'Percent of time',
       title = "Percent of time the Nesting male spent around his nest",
       fill = 'Distance') + #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars

  
```

#### Average SAT Presence at the Nest between years per nest

```{r}
SAT.presence <- yearly_totals |>
  mutate('SatP_perN' = (`# SAT Present`/total_nests)*10, .after = 7) #creates the column with the percentage, multiplied by 10 to get to percentage

SAT.presence.plot <- SAT.presence |>
  ggplot(aes(Year_axis, SatP_perN, fill = Year_axis)) +
  geom_bar(stat = 'identity') +
  labs(x = 'Year', 
       y = 'Average Sat presence per nest',
       title = "Percent of time the Satellite was present at a Nest",
       fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars

SAT.presence.plot
```

#### Average Female Visits per nest between years

```{r}
T_female_visits <- yearly_totals |>
  mutate('visits_p_nest' = (`Total Female Visits`)/total_nests) |>
  ggplot(aes(Year_axis, visits_p_nest, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Female visits per nest',
      title = "Average Female visits per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars
  

T_female_visits
```

#### Average Female spawns between years

This is different from the next graph, because this is the number of females that spawned. So each female is only counted once, while females can spawn multiple times (which went to the total variable).

```{r}
A_female_spawns <- yearly_totals |>
  #Gets average total female spawns between the years
  mutate('avg_fspawns_nest' = (`Total Female Spawning`)/total_nests) |>
  ggplot(aes(Year_axis, avg_fspawns_nest, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Number of Females spawn per nest',
      title = "Average number of Female that spawn per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars
  
A_female_spawns
```

#### Average Total spawns between years

```{r}
T_total_spawns <- yearly_totals |>
  #Creates the column of total spawns per nest
  mutate('total_spawns_p_nest' = (`Total Spawns`)/total_nests) |>
  #Creates the plot
  ggplot(aes(Year_axis, total_spawns_p_nest, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total spawns per nest',
      title = "Average Total spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars
  

T_total_spawns
```

#### Average Total Nesting Male Spawns between years

This graph adds up all the columns that indicate Nesting male spawns and compares the averages between the years

```{r}
T_NM_spawns <- yearly_totals |>
  #Average total nesting male spawns 
  mutate('total_NM_spawns' = (`Total Spawns NM brought` + `Total spawns SAT passed to NM` + `Total Spawns SAT Brought` + `Total Spawns SNK brought`)/total_nests) |>
  ggplot(aes(Year_axis, total_NM_spawns, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total NM spawns per nest',
      title = "Average Total Nesting Male spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars  
  
T_NM_spawns
```

#### Total Satellite Spawns between years

This graph adds up all the columns that indicate Satellite spawns and compares between the years. Note, this is counting when the Satellite is *allowed* to spawn at the nest by the Nesting male.

```{r}
T_SAT_spawns <- yearly_totals |>
  mutate('T_SAT_spawn' = (`Total spawns NM brought, SAT only spawn` + `Total spawns SAT passed to NM but SAT only spawn` + `Total Spawns SAT brought, SAT only spawn`)/total_nests) |>
  ggplot(aes(Year_axis, T_SAT_spawn, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total SAT spawns per nest',
      title = "Average Total Satellite Male shared spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars  
  
T_SAT_spawns
```

This graph will count Satellite *sneak* spawns (note this does include sneaker sneaks).

```{r}
T_SAT_sneaks <- yearly_totals |>
  mutate('T_SAT_sneak' = (`Female visit NM brought, Sneaks SAT + SNK` + `Female visit NM brought, Sneaks SAT only` + `Female visit SAT pass NM, Sneaks SAT + SNK` + `Female visit SAT pass NM, Sneak SAT only` + `Female visit SAT only, Sneaks SAT + SNK` + `Female visit SAT only, Sneaks SAT only` + `Female visit SNK only, Sneaks SAT + SNK` + `Female visit SNK only, Sneaks SAT only`)/total_nests) |>
  ggplot(aes(Year_axis, T_SAT_sneak, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total SAT spawns per nest',
      title = "Average Total Satellite Male sneak spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars  
  
T_SAT_sneaks
```

This graph will do total SAT spawns, both shared and sneak

```{r}
T_SAT_spawns_both <- yearly_totals |>
  mutate('T_SAT_spawn_both' = (`Total spawns NM brought, SAT only spawn` + `Total spawns SAT passed to NM but SAT only spawn` + `Total Spawns SAT brought, SAT only spawn` + `Female visit NM brought, Sneaks SAT + SNK` + `Female visit NM brought, Sneaks SAT only` + `Female visit SAT pass NM, Sneaks SAT + SNK` + `Female visit SAT pass NM, Sneak SAT only` + `Female visit SAT only, Sneaks SAT + SNK` + `Female visit SAT only, Sneaks SAT only` + `Female visit SNK only, Sneaks SAT + SNK` + `Female visit SNK only, Sneaks SAT only`)/total_nests) |>
  ggplot(aes(Year_axis, T_SAT_spawn_both, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total SAT spawns per nest',
      title = "Average Total Satellite Male spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars  
  
T_SAT_spawns_both
```

#### Total Sneaker Spawns between years

This graph adds up all the columns that indicate Sneaker male spawns and compares between the years. Note, some sneaks are including SAT sneaks

```{r}
T_SNK_spawns <- yearly_totals |>
  mutate('total_sneaks' = (`Total Spawns SNK brought, SNK only spawn` + `Female visit NM brought, Sneaks SAT + SNK` + `Female visit NM brought, Sneaks SNK only` + `Female visit SAT pass NM, Sneaks SAT + SNK` + `Female visit SAT pass NM, Sneak SNK only` + `Female visit SAT only, Sneaks SAT + SNK` + `Female visit SAT only, Sneaks SNK only` + `Female visit SNK only, Sneaks SAT + SNK` + `Female visit SNK only, Sneaks SNK only`)/total_nests) |>
  ggplot(aes(Year_axis, total_sneaks, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total Sneaker spawns per nest',
      title = "Average Total Sneaker Male spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars 

T_SNK_spawns
```

Graph is for sneakers only

```{r}
T_SNK_spawns_only <- yearly_totals |>
  mutate('total_sneaks_only' = (`Total Spawns SNK brought, SNK only spawn`+ `Female visit NM brought, Sneaks SNK only` +`Female visit SAT pass NM, Sneak SNK only` + `Female visit SAT only, Sneaks SNK only` + `Female visit SNK only, Sneaks SNK only`)/total_nests) |>
  ggplot(aes(Year_axis, total_sneaks_only, fill = Year_axis)) +
  geom_col() +
  labs(x = 'Year', 
      y = 'Total Sneaker only spawns per nest',
      title = "Average Total Sneaker Male spawns per nest between years",
      fill = 'Year') +  #edits axis and title labels
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5)) + #Moves title to the middle
  scale_fill_brewer(palette = "Dark2") #Colors the bars 

T_SNK_spawns_only
```

### Other, Not Year Specific, Exploratory graphs

#### Female visits and Female Spawns

Presumably, more visits should = more spawns is this true?

```{r}

```

#### Nesting Male aggression effect on Female visits and spawns

This adds up all the columns related to Nesting male aggression (Except aggression towards/away from nest, this will be graphed later) and looks for any correlation with female visits and spawns

```{r}

```

#### Satellite Male aggression effect on Female Visits and Spawns

This adds up all the columns related to Satellite male aggression (Except aggression towards/away from nest, this will be graphed later) and looks for any correlation with female visits and spawns

```{r}

```

#### Satellite and Nesting Male aggression to Females, away and towards the nest

We would expect any aggression to have negative impacts on female spawns, possibly also visits

```{r}

```

#### Sneaker Presence and Female Visits

From previous research it has been found that females use the presence of sneakers as a proxy for Nesting Male success, this graph will double check that

```{r}

```

#### Positive interactions between Satellite and Nesting Male and Female Visits and Spawns

This will add up the positive interactions occurring between the Satellite and Nesting Male (female passing)

```{r}

```

#### Negative interactions between Satellite and Nesting Male and Female Visits and Spawn

This does the same above, except with the negative interactions between Satellite and Nesting Male (SAT Submission to NM, NM aggression to SAT).

```{r}

```

#### Satellite and Nesting male interactions against sneakers effect on Female Visits and Spawns

Female prefer to not spawn with sneakers, thus higher Satellite and Nesting male aggression towards sneakers should increase the number of spawns. However, too many sneakers to chase means not enough time to spawn. This graph will let us see the relationship.

```{r}

```

#### Nesting male courtship and Female Visits and Spawns

```{r}

```

#### Does it matter who brings the female?

These graphs will look at the relationship between which male type brings the female and female spawning.

```{r}

```
